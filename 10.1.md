## Chapter 10. OpenAI ê¸°ë°˜ ì±—ë´‡/ì—ì´ì „íŠ¸ ê°œë°œ  
### 10.1 Flask, FastAPI ê¸°ë°˜ OpenAI ì„œë¹„ìŠ¤ êµ¬ì¶•

OpenAI APIë¥¼ ì‹¤ì œ ì„œë¹„ìŠ¤ë¡œ êµ¬ì¶•í•˜ê¸° ìœ„í•´ì„œëŠ” ì›¹ ì„œë²„ë¥¼ í†µí•´ ì™¸ë¶€ë¡œë¶€í„°ì˜ ìš”ì²­ì„ ë°›ê³  ì´ë¥¼ API í˜¸ì¶œë¡œ ì²˜ë¦¬í•œ ê²°ê³¼ë¥¼ ì‘ë‹µí•˜ëŠ” ê³¼ì •ì„ ì„¤ê³„í•´ì•¼ í•©ë‹ˆë‹¤. Python ê¸°ë°˜ ì›¹ í”„ë ˆì„ì›Œí¬ì¸ Flaskì™€ FastAPIëŠ” ì´ëŸ¬í•œ ì‘ì—…ì— ë§¤ìš° ì í•©í•œ ë„êµ¬ì…ë‹ˆë‹¤. ë³¸ ì ˆì—ì„œëŠ” ë‹¤ì–‘í•œ í™˜ê²½ì— ì ìš©í•  ìˆ˜ ìˆë„ë¡ ë‘ í”„ë ˆì„ì›Œí¬ ê¸°ë°˜ì—ì„œì˜ ì‹¤ì „ êµ¬ì¶• ë°©ì‹ì„ ìƒì„¸íˆ ë‹¤ë£¹ë‹ˆë‹¤.



### ğŸ” 1. Flask vs FastAPI: ì–´ë–¤ ê²ƒì„ ì„ íƒí• ê¹Œ?

| í•­ëª© | Flask | FastAPI |
|------|--------|----------|
| ì¶œì‹œ ì‹œê¸° | 2010ë…„ | 2018ë…„ |
| ë¹„ë™ê¸° ì§€ì› | ë¯¸ì•½ (ì¶”ê°€ íŒ¨í‚¤ì§€ í•„ìš”) | ê¸°ë³¸ ì§€ì› (async/await ê¸°ë°˜) |
| ë¬¸ì„œí™” | ìˆ˜ë™ Swagger ìƒì„± | ìë™ Swagger (OpenAPI) ë¬¸ì„œ |
| í•™ìŠµ ê³¡ì„  | ë‚®ìŒ | ì¤‘ê°„ |
| ì„±ëŠ¥ | ë³´í†µ | ë¹ ë¦„ |
| ì»¤ë®¤ë‹ˆí‹°/ìƒíƒœê³„ | ë§¤ìš° í¼ | ë¹ ë¥´ê²Œ ì„±ì¥ ì¤‘ |

- ê°„ë‹¨í•œ í”„ë¡œí† íƒ€ì…, í•™ìŠµ ëª©ì  â†’ Flask ì¶”ì²œ
- ë¹„ë™ê¸° API, ì„±ëŠ¥ ì¤‘ìš”, FastAPI íŠ¹í™” ê¸°ëŠ¥ í™œìš© â†’ FastAPI ì¶”ì²œ

ë‘ í”„ë ˆì„ì›Œí¬ ëª¨ë‘ OpenAI APIì™€ ì—°ë™ì´ ê°€ëŠ¥í•˜ë©°, ì‘ë‹µ ì²˜ë¦¬, ë¼ìš°íŒ…, ì—ëŸ¬ í•¸ë“¤ë§ ë“± í•µì‹¬ ê¸°ëŠ¥ì„ ì¶©ë¶„íˆ ì§€ì›í•©ë‹ˆë‹¤.



### ğŸ§± 2. ì„œë¹„ìŠ¤ êµ¬ì¡° ê°œìš”

OpenAI APIë¥¼ í™œìš©í•œ Flask ë˜ëŠ” FastAPI ê¸°ë°˜ ì„œë¹„ìŠ¤ì˜ ì¼ë°˜ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

```
 í´ë¼ì´ì–¸íŠ¸ (ë¸Œë¼ìš°ì €/ì•±)
       â†“
 Python ì›¹ ì„œë²„ (Flask/FastAPI)
       â†“
   OpenAI API í˜¸ì¶œ
       â†“
  ê²°ê³¼ ë°˜í™˜ ë° ì‘ë‹µ
```

- ì‚¬ìš©ìì˜ ì…ë ¥ì„ POST ë°©ì‹ìœ¼ë¡œ ì„œë²„ì— ì „ë‹¬
- ì„œë²„ëŠ” OpenAI APIì— ì „ë‹¬ â†’ ì‘ë‹µ
- ë°›ì€ ì‘ë‹µì„ ì ì ˆíˆ ê°€ê³µí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ë°˜í™˜



### âš™ï¸ 3. Flask ê¸°ë°˜ OpenAI ì±—ë´‡ ì„œë²„ êµ¬ì¶•

#### 3.1 í™˜ê²½ ì„¤ì • ë° í•„ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
pip install flask openai python-dotenv
```

`.env` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ë¯¼ê°ì •ë³´ ì €ì¥:

```env
OPENAI_API_KEY=sk-xxxxx
```

#### 3.2 ê¸°ë³¸ ì„œë²„ ì½”ë“œ êµ¬ì„±

```python
# app.py
import os
from flask import Flask, request, jsonify
import openai
from dotenv import load_dotenv

load_dotenv()
openai.api_key = os.getenv("OPENAI_API_KEY")

app = Flask(__name__)

@app.route("/chat", methods=["POST"])
def chat():
    data = request.get_json()
    user_input = data.get("message", "")

    try:
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",  # ë˜ëŠ” "gpt-4"
            messages=[
                {"role": "system", "content": "ë‹¹ì‹ ì€ ì¹œì ˆí•œ ë„ìš°ë¯¸ì…ë‹ˆë‹¤."},
                {"role": "user", "content": user_input}
            ]
        )
        result = response['choices'][0]['message']['content']
        return jsonify({"response": result})
    except Exception as e:
        return jsonify({"error": str(e)}), 500

if __name__ == "__main__":
    app.run(debug=True)
```

#### 3.3 í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ (curl ë˜ëŠ” Postman)

```bash
curl -X POST http://localhost:5000/chat \
    -H "Content-Type: application/json" \
    -d '{"message": "GPTì—ê²Œ ìê¸°ì†Œê°œë¥¼ í•´ì¤˜"}'
```

â¡ï¸ ë°˜í™˜ ì˜ˆì‹œ:
```json
{
  "response": "ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” OpenAIê°€ ë§Œë“  GPTì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"
}
```



### âš™ï¸ 4. FastAPI ê¸°ë°˜ OpenAI ì±—ë´‡ ì„œë²„ êµ¬ì¶•

FastAPIë¥¼ ì‚¬ìš©í•  ê²½ìš° ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ë¬¸ì„œ ìë™í™”ì˜ ì´ì ì„ ëˆ„ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 4.1 ì„¤ì¹˜ ë° ì´ˆê¸° ì„¤ì •

```bash
pip install fastapi uvicorn openai python-dotenv
```

#### 4.2 ê¸°ë³¸ ì„œë²„ ì½”ë“œ êµ¬ì„±

```python
# main.py
import os
import openai
from fastapi import FastAPI, Request
from pydantic import BaseModel
from dotenv import load_dotenv

load_dotenv()
openai.api_key = os.getenv("OPENAI_API_KEY")

app = FastAPI()

class ChatRequest(BaseModel):
    message: str

@app.post("/chat")
async def chat(request: ChatRequest):
    try:
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "ë‹¹ì‹ ì€ ë§¤ìš° ìœ ìµí•œ ì±—ë´‡ì…ë‹ˆë‹¤."},
                {"role": "user", "content": request.message}
            ]
        )
        result = response['choices'][0]['message']['content']
        return {"response": result}
    except Exception as e:
        return {"error": str(e)}
```

#### 4.3 ì„œë²„ ì‹¤í–‰

```bash
uvicorn main:app --reload
```

#### 4.4 ìë™ ë¬¸ì„œ í™•ì¸

FastAPIëŠ” OpenAPI ë¬¸ì„œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤:

- ê¸°ë³¸ ë¬¸ì„œ: http://localhost:8000/docs
- ReDoc ìŠ¤íƒ€ì¼: http://localhost:8000/redoc



### ğŸ§¯ 5. ì—ëŸ¬ ì²˜ë¦¬ ë° ê²€ì¦ ê°•í™” (FastAPI ê¸°ì¤€)

```python
from fastapi.responses import JSONResponse
from fastapi.exceptions import RequestValidationError
from fastapi.middleware.cors import CORSMiddleware

# CORS í—ˆìš© (for frontend)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ë˜ëŠ” íŠ¹ì • originë§Œ
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.exception_handler(RequestValidationError)
async def validation_exception_handler(request, exc):
    return JSONResponse(
        status_code=400,
        content={"error": "ì…ë ¥ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤."}
    )
```

- ì˜ëª»ëœ ì…ë ¥ ì²˜ë¦¬
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ CORS ì²˜ë¦¬
- ì˜ˆì™¸ ë¦¬í„´ ì‹œ JSON í˜•ì‹ ìœ ì§€



### ğŸ” 6. ë³´ì•ˆ: API Key ë³´í˜¸ë¥¼ ìœ„í•œ í™˜ê²½ íŒŒì¼ ì‚¬ìš©

ì ˆëŒ€ API í‚¤ë¥¼ ì½”ë“œì— ì§ì ‘ í•˜ë“œì½”ë”©í•˜ì§€ ë§ˆì‹­ì‹œì˜¤.

```python
# ì•ˆì „í•œ ë°©ì‹
from dotenv import load_dotenv
load_dotenv()
openai.api_key = os.getenv("OPENAI_API_KEY")
```

- production í™˜ê²½ì—ì„œëŠ” `.env`ë¥¼ gitì— í¬í•¨í•˜ì§€ ì•Šë„ë¡ `.gitignore`ì— í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.



### ğŸ§ª 7. ì§€ì†ì  ê°œì„ ì„ ìœ„í•œ êµ¬ì¡° ë¶„ë¦¬ (ëª¨ë“ˆí™” ì˜ˆì‹œ)

ì¶”ì²œ êµ¬ì¡°:

```
- app/
  - __init__.py
  - main.py
  - routes/
      - chat.py
  - services/
      - openai_service.py
- .env
- requirements.txt
```

`services/openai_service.py` ì˜ˆì‹œ:

```python
import openai
from typing import List, Dict

def ask_chatgpt(messages: List[Dict[str, str]], model="gpt-3.5-turbo"):
    response = openai.ChatCompletion.create(
        model=model,
        messages=messages
    )
    return response["choices"][0]["message"]["content"]
```

ì´ëŸ¬í•œ êµ¬ì¡°ë¥¼ í†µí•´ ë°°í¬ ë° ìš´ì˜ ê·œëª¨ê°€ ì»¤ì§ˆ ë•Œ ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ì›Œì§‘ë‹ˆë‹¤.



### ğŸš€ 8. ê°„ë‹¨í•œ í™•ì¥ ì˜ˆì‹œ: Chat History ìœ ì§€

ì‘ë‹µë§Œ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ì´ì „ ëŒ€í™”ë¥¼ ìœ ì§€í•˜ë ¤ë©´ í”„ë¡ íŠ¸ì—ì„œ íˆìŠ¤í† ë¦¬ ë°°ì—´ì„ ìœ ì§€í•˜ê±°ë‚˜ ì„œë²„ì— ì„¸ì…˜ ì €ì¥ ê¸°ëŠ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.

```python
messages = [
    {"role": "system", "content": "ë‹¹ì‹ ì€ ê¸°ìˆ  ì§€ì› ë„ìš°ë¯¸ì…ë‹ˆë‹¤."},
    {"role": "user", "content": "ë…¸íŠ¸ë¶ì´ ë¶€íŒ…ì´ ì•ˆë¼ìš”"},
    {"role": "assistant", "content": "ì „ì›ì´ ì¼œì§€ì§€ ì•Šë‚˜ìš”? ì¶©ì „ê¸°ëŠ” ì—°ê²°ë˜ì–´ ìˆë‚˜ìš”?"},
    {"role": "user", "content": "ë„¤, ì—°ê²°ë˜ì–´ ìˆì–´ìš”"}
]
```

ì´ì²˜ëŸ¼ message ë°°ì—´ì„ ëˆ„ì í•˜ì—¬ ì „ë‹¬í•˜ë©´ ë³´ë‹¤ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” íë¦„ì´ ìœ ì§€ë©ë‹ˆë‹¤.



### âœ… ì •ë¦¬

| í•­ëª© | Flask | FastAPI |
|------|--------|----------|
| ì‚¬ìš© ë‚œì´ë„ | ì‰¬ì›€ | ì•½ê°„ ë” ë³µì¡ |
| ë¹„ë™ê¸° ì§€ì› | ê¸°ë³¸ ë¯¸ì§€ì› | ë¹„ë™ê¸° ê¸°ë°˜ êµ¬ì¡°í™” |
| ë¬¸ì„œ ìë™í™” | ì—†ìŒ | Swagger ìë™ ì œê³µ |
| ì¶”ì²œ ì‚¬ìš©ì²˜ | êµìœ¡ìš©, ê°„ë‹¨í•œ ë°±ì—”ë“œ | í”„ë¡œë•ì…˜, ì„±ëŠ¥ ìš”êµ¬ í° API |

OpenAI ê¸°ë°˜ì˜ ì‹¤ì œ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶•í•˜ë ¤ë©´ ë‹¨ìˆœ API í˜¸ì¶œë¿ ì•„ë‹ˆë¼ ë³´ì•ˆ, ì—ëŸ¬ í•¸ë“¤ë§, ì„±ëŠ¥, í™•ì¥ì„±ì„ í•¨ê»˜ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. Flaskì™€ FastAPIëŠ” ê°ê°ì˜ ì¥ë‹¨ì ì´ ìˆìœ¼ë©°, ëª©ì ì— ë”°ë¼ ì ì ˆí•œ í”„ë ˆì„ì›Œí¬ë¥¼ ì„ íƒí•´ OpenAI API ê¸°ë°˜ AI ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³¸ ì ˆì˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì±—ë´‡, ìš”ì•½ê¸°, ë²ˆì—­ ì„œë¹„ìŠ¤ ë“± ì‹¤ìš©ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.