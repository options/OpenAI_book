## 9.3 ì‹¤ìŠµ: ê³ ê° ì‘ëŒ€ ì‹œìŠ¤í…œì˜ ìŒì„±í™”

ì´ ì ˆì—ì„œëŠ” OpenAIì˜ Whisper ë° TTS(Text-to-Speech) APIë¥¼ í™œìš©í•˜ì—¬ ê¸°ì¡´ í…ìŠ¤íŠ¸ ê¸°ë°˜ ê³ ê° ì‘ëŒ€ ì‹œìŠ¤í…œì„ ìŒì„± ê¸°ë°˜ìœ¼ë¡œ í™•ì¥í•˜ëŠ” ì‹¤ìŠµì„ ì§„í–‰í•©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìŒì„± ì…ë ¥ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•œ í›„, ì´ë¥¼ OpenAIì˜ GPT ëª¨ë¸ë¡œ ì²˜ë¦¬í•˜ê³ , ë‹¤ì‹œ ìì—°ìŠ¤ëŸ¬ìš´ ìŒì„±ìœ¼ë¡œ ì¶œë ¥í•˜ì—¬ ë³´ë‹¤ ëª°ì…ê° ìˆëŠ” ëŒ€í™”í˜• ì‹œìŠ¤í…œì„ ë§Œë“œëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.



### ğŸ› ï¸ ì‹¤ìŠµ ëª©í‘œ

- ì‚¬ìš©ìì˜ ìŒì„± ì…ë ¥ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜(STT: Speech-to-Text)
- í…ìŠ¤íŠ¸ ì…ë ¥ì„ GPT ëª¨ë¸ì— ì „ë‹¬í•˜ì—¬ ì‘ë‹µ ìƒì„±
- ëª¨ë¸ ì‘ë‹µì„ ìŒì„±ìœ¼ë¡œ ë³€í™˜(TTS: Text-to-Speech)
- Flask ì„œë²„ë¥¼ í†µí•´ í”„ë¡ íŠ¸ì—”ë“œì™€ í†µì‹ í•˜ëŠ” REST ê¸°ë°˜ ìŒì„± ì±—ë´‡ êµ¬ì¶•



### 1ï¸âƒ£ ì‹¤ìŠµ ì¤€ë¹„ ì‚¬í•­

#### ğŸ”§ ì‚¬ì „ ì¤€ë¹„

- Python 3.8+
- OpenAI Python SDK (openai >= 1.0 ì´ìƒ)
- Flask
- FFmpeg (Whisper ìŒì„± ì²˜ë¦¬ìš© í•„ìˆ˜)
- ë§ˆì´í¬ ì…ë ¥ìš© í”„ë¡ íŠ¸ì—”ë“œ ë˜ëŠ” ì‚¬ì „ ë…¹ìŒëœ ìŒì„± íŒŒì¼

#### ğŸ“¦ í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

```bash
pip install openai flask pydub
```

Whisperê°€ MP3, WAV, M4A ë“±ì˜ ì˜¤ë””ì˜¤ íŒŒì¼ í˜•ì‹ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ffmpeg ì„¤ì¹˜ë„ í•„ìš”í•©ë‹ˆë‹¤.

```bash
# Ubuntu
sudo apt-get install ffmpeg

# MacOS (Homebrew)
brew install ffmpeg
```



### 2ï¸âƒ£ ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”

ë‹¤ìŒì€ ê³ ê° ì‘ëŒ€ ìŒì„± ì‹œìŠ¤í…œì˜ ê¸°ë³¸ ë°ì´í„° íë¦„ì…ë‹ˆë‹¤.

```
ğŸ¤ ì‚¬ìš©ì ìŒì„± ì…ë ¥
      â†“ (ë§ˆì´í¬ or ì˜¤ë””ì˜¤ íŒŒì¼)
[Whisper API]
      â†“ (í…ìŠ¤íŠ¸ ë³€í™˜)
[OpenAI GPT ëª¨ë¸ (Chat API)]
      â†“ (í…ìŠ¤íŠ¸ ì‘ë‹µ)
[Text-to-Speech API]
      â†“
ğŸ”Š ìŠ¤í”¼ì»¤ ë˜ëŠ” ì˜¤ë””ì˜¤ ì¶œë ¥ì„ í†µí•œ ì‘ë‹µ
```



### 3ï¸âƒ£ Step-by-Step ì‹¤ìŠµ

#### 3.1 ì‚¬ìš©ì ìŒì„± ì…ë ¥ â†’ Whisperë¡œ í…ìŠ¤íŠ¸ ë³€í™˜

Whisper API í˜¸ì¶œì€ ë‹¨ì¼ ì˜¤ë””ì˜¤ íŒŒì¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤. ì˜ˆì œë¥¼ ìœ„í•´ `audio_input.mp3`ë¼ëŠ” íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```python
import openai

openai.api_key = "your-api-key"

audio_file = open("audio_input.mp3", "rb")

transcript = openai.audio.transcriptions.create(
    model="whisper-1",
    file=audio_file,
    response_format="json"
)

print("ğŸ“ ë³€í™˜ëœ í…ìŠ¤íŠ¸:", transcript.text)
```

ğŸ“Œ ì°¸ê³ ì‚¬í•­:

- WhisperëŠ” ë‹¤ì–‘í•œ í¬ë§·ì„ ì§€ì›í•˜ì§€ë§Œ, ì‚¬ì „ì— ffmpegë¥¼ í†µí•´ WAV ë˜ëŠ” MP3ë¡œ ë³€í™˜í•´ ë‘ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
- ì‹¤ì‹œê°„ ìŒì„±ì„ ìŠ¤íŠ¸ë¦¬ë°í•˜ë ¤ë©´ WebRTC ë“±ì˜ ë³„ë„ êµ¬ì„± í•„ìš”



#### 3.2 ë³€í™˜ëœ í…ìŠ¤íŠ¸ â†’ GPTë¡œ ë‹µë³€ ìƒì„±

ì•ì—ì„œ ë°›ì€ í…ìŠ¤íŠ¸(transcript.text)ë¥¼ ëŒ€í™”í˜• í”„ë¡¬í”„íŠ¸ë¡œ GPTì—ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.

```python
response = openai.chat.completions.create(
    model='gpt-4',
    messages=[
        {"role": "system", "content": "ë‹¹ì‹ ì€ ì¹œì ˆí•œ ê³ ê° ì„œë¹„ìŠ¤ ìƒë‹´ì›ì…ë‹ˆë‹¤."},
        {"role": "user", "content": transcript.text}
    ]
)

result_text = response.choices[0].message.content
print("ğŸ¤– GPT ì‘ë‹µ:", result_text)
```

ğŸ“Œ í”„ë¡¬í”„íŠ¸ êµ¬ì¡° ì‚¬ìš© íŒ:

- ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ í™œìš©í•˜ì—¬ ì¼ê´€ëœ ì–´íˆ¬ ë° ì‘ë‹µ ìŠ¤íƒ€ì¼ ìœ ì§€
- ëŒ€í™” ë§¥ë½ì„ ìœ„í•´ message historyë¥¼ ìœ ì§€í•˜ë©´ ì§€ì†ì ì¸ ìƒë‹´ ê°€ëŠ¥



#### 3.3 GPT ì‘ë‹µ â†’ Text-to-Speechë¡œ ìŒì„± ì¶œë ¥

GPTê°€ ìƒì„±í•œ ì‘ë‹µì„ TTS APIë¡œ ì „ë‹¬í•˜ì—¬ ìŒì„±ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```python
speech_response = openai.audio.speech.create(
    model="tts-1-hd",
    voice="nova",  # other options: alloy, shimmer, echo, fable, onyx
    input=result_text
)

# ì‘ë‹µì„ íŒŒì¼ë¡œ ì €ì¥
with open("output_speech.mp3", "wb") as f:
    f.write(speech_response.content)
```

ì´í›„ í•´ë‹¹ MP3 íŒŒì¼ì„ ì›¹í˜ì´ì§€, ë°ìŠ¤í¬íƒ‘ ì•±, ìŠ¤ë§ˆíŠ¸í° ë“±ì—ì„œ ì¬ìƒí•˜ë©´ ìŒì„± ì‘ë‹µì´ êµ¬í˜„ë©ë‹ˆë‹¤.

ğŸ“Œ TTS ì¶œë ¥ í’ˆì§ˆ íŒ:

- `tts-1-hd` ëª¨ë¸ì€ ê³ ìŒì§ˆì„ ì œê³µí•˜ë©° ì¶”ê°€ latency ë°œìƒ ê°€ëŠ¥
- `voice` íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ì‚¬ìš©ì ë§ì¶¤í™”. (agentì— ì–´ìš¸ë¦¬ëŠ” ëª©ì†Œë¦¬ ì„ íƒ)



### 4ï¸âƒ£ Flaskë¡œ RESTful ì„œë¹„ìŠ¤ êµ¬ì„± (ë² ì´ìŠ¤ë¼ì¸)

ìŒì„± ê¸°ë°˜ ì±—ë´‡ì„ ì„œë²„ í˜•íƒœë¡œ ì œê³µí•˜ê³  ì‹¶ë‹¤ë©´ Flaskì™€ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
from flask import Flask, request, jsonify
import openai
import tempfile

app = Flask(__name__)
openai.api_key = "your-api-key"

@app.route("/voice-chat", methods=["POST"])
def voice_chat():
    audio = request.files['audio']

    # ìŒì„± íŒŒì¼ ì²˜ë¦¬
    with tempfile.NamedTemporaryFile(delete=False, suffix=".mp3") as tmp:
        audio.save(tmp.name)

        transcript = openai.audio.transcriptions.create(
            model="whisper-1",
            file=open(tmp.name, "rb")
        )

    gpt_response = openai.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "ë‹¹ì‹ ì€ ê³ ê° ì‘ëŒ€ ì „ë¬¸ ìƒë‹´ì›ì…ë‹ˆë‹¤."},
            {"role": "user", "content": transcript.text}
        ]
    )

    result_text = gpt_response.choices[0].message.content

    tts_audio = openai.audio.speech.create(
        model="tts-1",
        voice="nova",
        input=result_text
    )

    # ì‘ë‹µìœ¼ë¡œ ìŒì„± íŒŒì¼ ë°˜í™˜
    return tts_audio.content, 200, {
        'Content-Type': 'audio/mpeg',
        'Content-Disposition': 'inline; filename=reply.mp3'
    }

if __name__ == "__main__":
    app.run(debug=True)
```

ğŸ›°ï¸ í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ê°„ë‹¨ ì„¤ëª…:

- ì‚¬ìš©ì ë§ˆì´í¬ ì…ë ¥ â†’ ìŒì„± íŒŒì¼ë¡œ Blob ìƒì„±
- FormDataë¡œ POST /voice-chat ì „ì†¡
- ê²°ê³¼ ì‘ë‹µìœ¼ë¡œ ë°›ì€ MP3ë¥¼ ì›¹ìƒì—ì„œ ë°”ë¡œ ì¬ìƒ



### 5ï¸âƒ£ í™•ì¥ ì•„ì´ë””ì–´ (Advanced)

- âœ… ì›¹ ê¸°ë°˜ ìŒì„± ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ (Streamlit, React + WebRTC ë“± í™œìš©)
- âœ… ëŒ€í™” ìƒíƒœ ë©”ëª¨ë¦¬(context memory) ìœ ì§€í•˜ì—¬ ì—°ì† ìƒë‹´ í˜•ì‹ êµ¬ì„±
- âœ… ìŒì„± ìë™ ì¸ì‹ ì‹¤íŒ¨ ì‹œ fallback ë©”ì‹œì§€ ì œê³µ (â€œì£„ì†¡í•´ìš”, ë‹¤ì‹œ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?â€)
- âœ… ê³ ê° ìš”ì²­ ìœ í˜• ë¶„ë¥˜ (ì˜ˆ: ì¼ë°˜ ë¬¸ì˜ / ë¶ˆë§Œ ì ‘ìˆ˜ / ì£¼ë¬¸ ìƒíƒœ í™•ì¸ ë“±)



### ğŸ§ª í…ŒìŠ¤íŠ¸ì™€ ê²€ìˆ˜

| í•­ëª© | ì²´í¬ë¦¬ìŠ¤íŠ¸ |
|------|------------|
| ìŒì„± ì¸ì‹ ì •í™•ë„ | ë‹¤ì–‘í•œ ì–µì–‘/ì†ë„ì—ì„œë„ ì˜ ì‘ë™í•˜ëŠ”ê°€? |
| ì‘ë‹µ ìì—°ìŠ¤ëŸ¬ì›€ | ëª©ì†Œë¦¬ í†¤ê³¼ ì–µì–‘ì´ ìƒë‹´ì›ì²˜ëŸ¼ ë“¤ë¦¬ëŠ”ê°€? |
| ì‘ë‹µ ì‹œê°„ | ìŒì„± ì…ë ¥ â†’ ì‘ë‹µê¹Œì§€ 3~5ì´ˆ ë‚´ì™¸ ìœ ì§€ë˜ëŠ”ê°€? |
| ë³´ì•ˆ | API í‚¤ê°€ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ë˜ê³  ìˆëŠ”ê°€? |



### âœ… ì •ë¦¬

- Whisper STTì™€ GPT, TTSë¥¼ ì—°ë™í•˜ì—¬ ìœ ìš©í•œ ìŒì„± ê¸°ë°˜ ê³ ê° ìƒë‹´ ì‹œìŠ¤í…œì„ ì†ì‰½ê²Œ êµ¬í˜„ ê°€ëŠ¥
- ì˜¤ë””ì˜¤ ì²˜ë¦¬ ìë™í™”ì™€ ë¹ ë¥¸ ì‘ë‹µ ìƒì„±ì„ í†µí•´ ì‚¬ìš©ì ê²½í—˜ ê·¹ëŒ€í™”
- í–¥í›„ ì±—ë´‡ê³¼ í†µí•©í•˜ê±°ë‚˜ ë©€í‹°ëª¨ë‹¬ ê¸°ëŠ¥ì„ ê²°í•©í•˜ì—¬ ë”ìš± ê³ ë„í™”ëœ ì‘ëŒ€ ì‹œìŠ¤í…œìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥



ë‹¤ìŒ ì ˆì—ì„œëŠ” ì´ëŸ¬í•œ ìŒì„± ì‹œìŠ¤í…œì— ë‹¤êµ­ì–´ ì²˜ë¦¬ ê¸°ëŠ¥ì„ í†µí•©í•˜ì—¬ ê¸€ë¡œë²Œ ì‚¬ìš©ì ëŒ€ìƒ ì‹¤ì‹œê°„ ì‘ë‹µì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ë°°ì›ë‹ˆë‹¤.