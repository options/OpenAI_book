ë¬¼ë¡ ì…ë‹ˆë‹¤. ì•„ë˜ëŠ” ã€ŒChapter 7. Function Calling & JSON Modeã€ ì¤‘ 7.2ì ˆ ã€Œì˜ˆì œ: ê³„ì‚°ê¸°, ë‚ ì”¨ API, DB ì¡°íšŒê¸°ã€ì˜ ë‚´ìš© ì´ˆì•ˆì…ë‹ˆë‹¤. ì´ ì ˆì—ì„œëŠ” OpenAIì˜ Function Calling ê¸°ëŠ¥ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°ê¸°, ë‚ ì”¨ ì •ë³´ ì œê³µ, ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì—°ë™ ë“±ì˜ ì‘ìš© ì˜ˆì œë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.



# 7.2 ì˜ˆì œ: ê³„ì‚°ê¸°, ë‚ ì”¨ API, DB ì¡°íšŒê¸°

Function Calling ê¸°ëŠ¥ì„ í†µí•´ GPT ëª¨ë¸ì—ê²Œ êµ¬ì¡°í™”ëœ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ê²Œ í•˜ì—¬ ë‹¤ì–‘í•œ ì™¸ë¶€ ê¸°ëŠ¥ê³¼ì˜ ì—°ë™ ê¸°ë°˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³¸ ì ˆì—ì„œëŠ” ëŒ€í‘œì ì¸ ì„¸ ê°€ì§€ ì—°ë™ ì˜ˆì œë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ Function Callingì˜ ì‹¤ì „ í™œìš©ì„ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.

- ê³„ì‚°ê¸° (ì‚°ìˆ  ì—°ì‚° API)
- ë‚ ì”¨ ì¡°íšŒ (ì™¸ë¶€ API í˜¸ì¶œ)
- ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒê¸° (DB ì¿¼ë¦¬ ì‹¤í–‰)

ì´ ì˜ˆì œë“¤ì€ GPTì˜ ì¸ê³µì§€ëŠ¥ ëŠ¥ë ¥ê³¼ êµ¬ì¡°í™”ëœ í”„ë¡œê·¸ë˜ë° í˜¸ì¶œ ë°©ì‹ì˜ ê²°í•©ì„ ë³´ì—¬ ì£¼ëŠ” í›Œë¥­í•œ ë°ëª¨ì…ë‹ˆë‹¤.



## ğŸ§® 7.2.1 ê³„ì‚°ê¸° í•¨ìˆ˜ ì˜ˆì œ

ê°€ì¥ ê¸°ë³¸ì ì´ë©´ì„œë„ GPTë¡œ ìˆ˜í–‰í•˜ê¸°ì—ëŠ” ë¶€ì •í™•í•  ìˆ˜ ìˆëŠ” ëŒ€í‘œì ì¸ ì‘ì—…ì´ ë°”ë¡œ ì‚°ìˆ  ì—°ì‚°ì…ë‹ˆë‹¤. â€œ3.87 ê³±í•˜ê¸° 12.5ëŠ” ì–¼ë§ˆì•¼?â€ì™€ ê°™ì€ ì§ˆë¬¸ì€ ì–¸ëœ» ë‹¨ìˆœí•´ ë³´ì´ì§€ë§Œ, AI ëª¨ë¸ì€ ì¢…ì¢… ë¶€ì •í™•í•œ ê²°ê³¼ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.

Function Callingì„ ì‚¬ìš©í•˜ë©´ ëª¨ë¸ì´ ì •í™•í•œ ìˆ«ì ê³„ì‚° ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë„ë¡ ì™¸ë¶€ ê³„ì‚° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ“Œ 1. í•¨ìˆ˜ ì •ì˜

ê³„ì‚°ì„ ìœ„í•œ ê°„ë‹¨í•œ í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ë©ë‹ˆë‹¤:

```python
def calculate(operator: str, a: float, b: float) -> float:
    if operator == "add":
        return a + b
    elif operator == "subtract":
        return a - b
    elif operator == "multiply":
        return a * b
    elif operator == "divide" and b != 0:
        return a / b
    else:
        raise ValueError("ì˜ëª»ëœ ì—°ì‚°ì ë˜ëŠ” 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸°")
```

### ğŸ“Œ 2. Function Schema ì •ì˜

OpenAI APIì— ì´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ëª…ì„¸í•©ë‹ˆë‹¤.

```python
function_def = {
    "name": "calculate",
    "description": "ë‘ ìˆ«ìì— ëŒ€í•´ ì§€ì •ëœ ì‚¬ì¹™ì—°ì‚°ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.",
    "parameters": {
        "type": "object",
        "properties": {
            "operator": {
                "type": "string",
                "enum": ["add", "subtract", "multiply", "divide"],
                "description": "ìˆ˜í–‰í•  ì—°ì‚°: add, subtract, multiply, divide"
            },
            "a": {
                "type": "number",
                "description": "ì²« ë²ˆì§¸ ìˆ«ì"
            },
            "b": {
                "type": "number",
                "description": "ë‘ ë²ˆì§¸ ìˆ«ì"
            }
        },
        "required": ["operator", "a", "b"]
    }
}
```

### ğŸ“Œ 3. GPT í˜¸ì¶œ ì˜ˆì‹œ

```python
from openai import OpenAI
client = OpenAI()

response = client.chat.completions.create(
    model="gpt-4",
    messages=[
        {"role": "user", "content": "128 ë‚˜ëˆ„ê¸° 4ëŠ” ì–¼ë§ˆì•¼?"},
    ],
    functions=[function_def],
    function_call="auto"
)
```

GPTëŠ” ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ì´í•´í•˜ê³  `calculate` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ì‘ë‹µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```json
{
  "function_call": {
    "name": "calculate",
    "arguments": "{\"operator\":\"divide\",\"a\":128,\"b\":4}"
  }
}
```

ì´í›„ í•´ë‹¹ í•¨ìˆ˜ í˜¸ì¶œ ê²°ê³¼ë¥¼ ê°€ì§€ê³  GPTì—ê²Œ ë‹¤ì‹œ ì „ë‹¬í•˜ë©´ ìµœì¢… ì‘ë‹µì´ ìƒì„±ë©ë‹ˆë‹¤.



## â˜ï¸ 7.2.2 ë‚ ì”¨ API ì—°ë™

GPTê°€ ì‹¤ì‹œê°„ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ì—†ë‹¤ëŠ” ê°€ì¥ í° ì œì•½ì„ ê·¹ë³µí•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ê°€ Function Callingì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì™¸ë¶€ ë‚ ì”¨ API(OpenWeatherMap ë“±)ë¥¼ ì—°ë™í•´ GPTê°€ ì‹¤ì‹œê°„ ë‚ ì”¨ ì •ë³´ë¥¼ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•˜ë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤.

### ğŸ“Œ 1. ì˜ˆì‹œ: OpenWeatherMap API í˜¸ì¶œ í•¨ìˆ˜

```python
import requests

def get_weather(city: str) -> str:
    API_KEY = "YOUR_OPENWEATHERMAP_API_KEY"
    url = f"http://api.openweathermap.org/data/2.5/weather?q={city}&appid={API_KEY}&units=metric"
    response = requests.get(url)
    data = response.json()
    weather = data["weather"][0]["description"]
    temp = data["main"]["temp"]
    return f"{city}ì˜ í˜„ì¬ ë‚ ì”¨ëŠ” {weather}ì´ë©° ê¸°ì˜¨ì€ {temp}Â°Cì…ë‹ˆë‹¤."
```

### ğŸ“Œ 2. Function Schema ì •ì˜

```python
weather_function = {
    "name": "get_weather",
    "description": "ì§€ì •í•œ ë„ì‹œì˜ í˜„ì¬ ë‚ ì”¨ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.",
    "parameters": {
        "type": "object",
        "properties": {
            "city": {
                "type": "string",
                "description": "ì¡°íšŒí•  ë„ì‹œ ì´ë¦„ (ì˜ˆ: Seoul, New York)"
            }
        },
        "required": ["city"]
    }
}
```

### ğŸ“Œ 3. GPT í˜¸ì¶œ ë° í•¨ìˆ˜ ì‹¤í–‰ íë¦„

```python
response = client.chat.completions.create(
    model="gpt-4",
    messages=[
        {"role": "user", "content": "ì„œìš¸ì˜ ë‚ ì”¨ ì•Œë ¤ì¤˜"}
    ],
    functions=[weather_function],
    function_call="auto"
)
```

GPTì˜ ì‘ë‹µì´ ë‹¤ìŒê³¼ ê°™ë‹¤ë©´:

```json
{
  "function_call": {
    "name": "get_weather",
    "arguments": "{\"city\":\"Seoul\"}"
  }
}
```

í•´ë‹¹ í•¨ìˆ˜ ê²°ê³¼:

```python
weather_info = get_weather("Seoul")
```

ê²°ê³¼ ë©”ì‹œì§€ë¥¼ GPTì—ê²Œ ì „ë‹¬:

```python
[
    {"role": "assistant", "content": None, "function_call": {...}},
    {"role": "function", "name": "get_weather", "content": weather_info}
]
```



## ğŸ—ƒï¸ 7.2.3 ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒê¸° (DB ì¡°íšŒ)

ê¸°ì—… ë‚´ ì‹œìŠ¤í…œ, ì˜ˆì»¨ëŒ€ ê³ ê° ì •ë³´, ì¬ê³  í˜„í™©, ì§ì› ë°ì´í„° ë“±ì„ GPTë¥¼ í†µí•´ ì¡°íšŒí•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ“Œ 1. SQLiteë¥¼ í™œìš©í•œ ì˜ˆì‹œ: ì‚¬ìš©ì ì´ë©”ì¼ ì¡°íšŒ

ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì„± ì˜ˆì‹œ:

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    name TEXT,
    email TEXT
);
```

ìƒ˜í”Œ ë°ì´í„°:

```sql
INSERT INTO users (name, email)
VALUES ('í™ê¸¸ë™', 'hong@example.com'), ('ê¹€ì˜í¬', 'kim@example.com');
```

íŒŒì´ì¬ í•¨ìˆ˜:

```python
import sqlite3

def get_user_email(name: str) -> str:
    conn = sqlite3.connect("users.db")
    cursor = conn.cursor()
    cursor.execute("SELECT email FROM users WHERE name=?", (name,))
    result = cursor.fetchone()
    conn.close()
    if result:
        return f"{name}ë‹˜ì˜ ì´ë©”ì¼ì€ {result[0]}ì…ë‹ˆë‹¤."
    else:
        return f"{name}ë‹˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
```

### ğŸ“Œ 2. Function Schema ì •ì˜

```python
db_function = {
    "name": "get_user_email",
    "description": "ì‚¬ìš©ìì˜ ì´ë¦„ì„ ê¸°ë°˜ìœ¼ë¡œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.",
    "parameters": {
        "type": "object",
        "properties": {
            "name": {
                "type": "string",
                "description": "ì´ë©”ì¼ì„ ì¡°íšŒí•  ì‚¬ëŒì˜ ì´ë¦„"
            }
        },
        "required": ["name"]
    }
}
```

### ğŸ“Œ 3. GPT í˜¸ì¶œ ë° ì›Œí¬í”Œë¡œìš°

```python
response = client.chat.completions.create(
    model="gpt-4",
    messages=[
        {"role": "user", "content": "ê¹€ì˜í¬ë‹˜ì˜ ì´ë©”ì¼ ì£¼ì†Œê°€ ë­ì•¼?"}
    ],
    functions=[db_function],
    function_call="auto"
)
```

GPTê°€ ë‹¤ìŒê³¼ ê°™ì´ ì‘ë‹µí•˜ë©´:

```json
{
  "function_call": {
    "name": "get_user_email",
    "arguments": "{\"name\":\"ê¹€ì˜í¬\"}"
  }
}
```

ì´ë¥¼ í•¨ìˆ˜ë¡œ ì²˜ë¦¬:

```python
email = get_user_email("ê¹€ì˜í¬")
```

ì´í›„ ë©”ì‹œì§€ íë¦„ì— ê²°ê³¼ ì—°ê²°:

```python
[
    {"role": "assistant", "content": None, "function_call": {...}},
    {"role": "function", "name": "get_user_email", "content": email}
]
```



## âœ… ë§ˆë¬´ë¦¬ ë° í™•ì¥ ì•„ì´ë””ì–´

Function Callingì€ GPTê°€ ë‚´ë¶€ â€œì§€ì‹ ê¸°ë°˜â€ì´ ì•„ë‹Œ â€œì™¸ë¶€ ë„êµ¬ë‚˜ ë°ì´í„°â€ì™€ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒí˜¸ì‘ìš©í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

| use case | ì‚¬ìš© ë„êµ¬ | í™œìš© í¬ì¸íŠ¸ |
|----------|------------|--------------|
| ê³„ì‚°ê¸° | ë‚´ë¶€ ì •ì˜ëœ ì—°ì‚° í•¨ìˆ˜ | ì •í™•ì„± ë†’ì´ê¸° |
| ë‚ ì”¨ | ì™¸ë¶€ API(OpenWeatherMap) | ì‹¤ì‹œê°„ ì™¸ë¶€ ì •ë³´ ì—°ë™ |
| ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ | SQLite, SQLAlchemy ë“± | ê¸°ì—… ì „ì‚°ì‹œìŠ¤í…œ í†µí•© |

ì¶”ê°€ì ìœ¼ë¡œ Function Callingì€ ë‹¤ìŒê³¼ ê°™ì€ ë°©í–¥ìœ¼ë¡œ í™•ì¥ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ê²€ìƒ‰ ì—”ì§„ê³¼ ì—°ë™í•˜ì—¬ ìµœì‹  ì •ë³´ ì „ë‹¬
- ERP, CRM ì‹œìŠ¤í…œê³¼ ì—°ê²°
- ê¸ˆìœµ ë°ì´í„° ì‹¤ì‹œê°„ ì¡°íšŒê¸° êµ¬í˜„
- ì‚¬ìš©ì ë§ì¶¤í˜• ì¶”ì²œ ì‹œìŠ¤í…œ

ì´ ê¸°ëŠ¥ì€ AIë¥¼ í•˜ë‚˜ì˜ â€˜ìŠ¤ë§ˆíŠ¸ í—ˆë¸Œâ€™ë¡œ ì§„í™”ì‹œí‚¤ëŠ” ê°•ë ¥í•œ í†µë¡œì…ë‹ˆë‹¤.

ë‹¤ìŒ ì ˆì—ì„œëŠ” ì´ Function Calling ê¸°ìˆ ê³¼ JSON Modeë¥¼ ê²°í•©í•˜ì—¬ êµ¬ì¡°í™”ëœ ì‘ë‹µì„ ê°•ì œí•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

