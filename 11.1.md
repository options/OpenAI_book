# Chapter 11.1 Thread, Message, ToolCall êµ¬ì¡°ì˜ ì´í•´

OpenAIì˜ Assistants APIëŠ” ê¸°ì¡´ì˜ ë‹¨ìˆœí•œ ì¼íšŒì„± ëŒ€í™” ë°©ì‹ì—ì„œ ë²—ì–´ë‚˜, ì¥ê¸°ì ì¸ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ì™€ ë„êµ¬ ì¡°í•© ì‹¤í–‰ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ìƒˆë¡œìš´ ëŒ€í™”í˜• ì—ì´ì „íŠ¸ í”Œë«í¼ì…ë‹ˆë‹¤. Assistants APIë¥¼ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ìëŠ” ë‹¨ì¼ í˜¸ì¶œë¡œ ëë‚˜ëŠ” ì •ì  ì‘ë‹µì´ ì•„ë‹Œ, ì§€ì†ì ìœ¼ë¡œ ìƒíƒœë¥¼ ì´ì–´ê°€ëŠ” ë™ì  ìƒí˜¸ì‘ìš©, ë³µì¡í•œ ì‘ì—… ì²˜ë¦¬, ì½”ë“œ ì‹¤í–‰, ë„íë¨¼íŠ¸ ê²€ìƒ‰, ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ í˜¸ì¶œ ë“±ì˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì¥ì—ì„œëŠ” Assistants APIì˜ í•µì‹¬ êµ¬ì¡°ì¸ Thread, Message, ToolCallì„ ì¤‘ì‹¬ìœ¼ë¡œ ê·¸ ë™ì‘ ì›ë¦¬ë¥¼ **ì˜ˆì œ ì¤‘ì‹¬**ìœ¼ë¡œ ìƒì„¸íˆ í•´ì„¤í•©ë‹ˆë‹¤.



## 11.1.1 Assistants APIì˜ ì£¼ìš” ê°œë… ìš”ì•½

ë¨¼ì € ê°„ë‹¨íˆ ì„¸ ê°œë…ì˜ ì—­í• ì„ ê°œìš”ì ìœ¼ë¡œ ë¹„êµí•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

| ê°œë…         | ì„¤ëª… |
|--------------|------|
| Thread       | í•˜ë‚˜ì˜ ëŒ€í™” ì„¸ì…˜. Messagesì˜ ì»¨í…Œì´ë„ˆ. |
| Message      | user/assistantê°€ Thread ë‚´ì— ë‚¨ê¸´ ëŒ€í™” í•­ëª©. |
| ToolCall     | Assistantê°€ ë„êµ¬(ì½”ë“œ, ê²€ìƒ‰, í•¨ìˆ˜ ë“±)ë¥¼ ì‚¬ìš©í•˜ë ¤ í•  ë•Œì˜ í˜¸ì¶œ ì‹œë„. (function_call, code_interpreter ë“±) |



## 11.1.2 Threadë€ ë¬´ì—‡ì¸ê°€?

ThreadëŠ” íŠ¹ì • ì‚¬ìš©ìì™€ Assistant ê°„ì˜ í•˜ë‚˜ì˜ ëŒ€í™” ì„¸ì…˜ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê¸°ì¡´ Chat Completion APIì—ì„œì˜ ì»¨í…ìŠ¤íŠ¸ëŠ” ë§¤ í˜¸ì¶œë§ˆë‹¤ ë©”ì‹œì§€ë¥¼ ì§ì ‘ ìœ ì§€í•´ì•¼ í–ˆì§€ë§Œ, Assistants APIëŠ” ì„œë²„ ì¸¡ì—ì„œ Threadì— ë©”ì‹œì§€ì™€ ìƒíƒœ ì •ë³´ë¥¼ ì €ì¥í•˜ë©°, ì–¸ì œë“ ì§€ ì´ì–´ì„œ ëŒ€í™”ë¥¼ ê³„ì†í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### âœ… Threadì˜ íŠ¹ì§•

- ê³ ìœ í•œ thread_idë¥¼ í†µí•´ ì‹ë³„ë¨.
- ê°™ì€ Threadì— Messageë¥¼ ê³„ì† ì¶”ê°€í•¨ìœ¼ë¡œì¨ ëŒ€í™”ë¥¼ ì´ì–´ê°ˆ ìˆ˜ ìˆìŒ.
- AssistantëŠ” Threadì˜ ì „ì²´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ë‹µì„ ìƒì„±.

### ğŸ”§ ì˜ˆì œ: ìƒˆ Thread ìƒì„±

```python
from openai import OpenAI

client = OpenAI()

# ìƒˆë¡œìš´ Thread ìƒì„±
thread = client.beta.threads.create()
print(thread.id)  # ex: "thread_xyz123"
```



## 11.1.3 Messageë€ ë¬´ì—‡ì¸ê°€?

MessageëŠ” í•˜ë‚˜ì˜ ëŒ€í™” ë‹¨ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì§ˆë¬¸ì´ë‚˜ ì…ë ¥, Assistantì˜ ì‘ë‹µ ë“±ì´ ê°ê° í•˜ë‚˜ì˜ Messageë¡œ Thread ì•ˆì— ì €ì¥ë©ë‹ˆë‹¤.

### âœ… Messageì˜ êµ¬ì„± ìš”ì†Œ

- ì—­í•  (role): "user" ë˜ëŠ” "assistant"
- ë‚´ìš© (content): í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´ ë˜ëŠ” ì‘ë‹µ í…ìŠ¤íŠ¸
- ì²¨ë¶€ íŒŒì¼ (optional): íŒŒì¼ ID ë“±
- ìƒì„± ì‹œê°„, ê³ ìœ  ID ë“± ë©”íƒ€ë°ì´í„°

### ğŸ”¨ Message ì¶”ê°€ ì˜ˆì œ

```python
# Userê°€ Threadì— ë©”ì‹œì§€ë¥¼ ì¶”ê°€
user_input = "íŒŒì´ì¬ì—ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì—­ìˆœìœ¼ë¡œ ì •ë ¬í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?"

response = client.beta.threads.messages.create(
    thread_id=thread.id,
    role="user",
    content=user_input
)
```

ì´í›„ AssistantëŠ” ì´ Thread ë° Messageë¥¼ ì°¸ì¡°í•˜ì—¬ ì ì ˆí•œ ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤.



## 11.1.4 Run: Assistantê°€ Threadë¥¼ ì²˜ë¦¬í•˜ëŠ” ì‹¤í–‰ ë‹¨ìœ„

Assistantê°€ ì£¼ì–´ì§„ Threadë¥¼ ë¶„ì„í•˜ê³  Messageì— ì‘ë‹µí•˜ë ¤ë©´ 'Run'ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. Runì€ í•´ë‹¹ Threadì—ì„œ Assistantê°€ ë„ì¶œí•œ ì‘ë‹µ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¶”ì í•˜ëŠ” ë‹¨ìœ„ì…ë‹ˆë‹¤.

```python
run = client.beta.threads.runs.create(
    thread_id=thread.id,
    assistant_id="asst_abc123"
)
```

ì´í›„ ì´ Runì´ ëë‚˜ë©´, Assistantì˜ ì‘ë‹µì€ ìë™ìœ¼ë¡œ Messageë¡œ Threadì— ì¶”ê°€ë©ë‹ˆë‹¤.

âš ï¸ 'Run'ì´ë¼ëŠ” ê°œë…ì€ ëŒ€í™” í•˜ë‚˜í•˜ë‚˜ì— ëŒ€í•´ ìˆ˜í–‰ë˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ThreadëŠ” ëŒ€í™”ë°©ì´ê³ , Runì€ Assistantê°€ ì§ˆë¬¸ì— ë‹µí•˜ëŠ” ì‹¤í–‰ ì‘ì—…ì´ë¼ ì´í•´í•˜ì„¸ìš”.



## 11.1.5 ToolCall: ë„êµ¬ í˜¸ì¶œ êµ¬ì¡°

Assistants APIì—ì„œëŠ” AIê°€ ì™¸ë¶€ ë„êµ¬ë¥¼ í˜¸ì¶œí•´ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì˜ˆì»¨ëŒ€ ë³µì¡í•œ ê³„ì‚°ì„ Code Interpreterë¡œ ìˆ˜í–‰í•˜ê±°ë‚˜, íŠ¹ì • DBë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ Custom Function Callì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ë„êµ¬ ìš”ì²­ì€ ToolCallë¡œ í‘œí˜„ë©ë‹ˆë‹¤.

### âœ… ToolCallì´ë€?

ToolCallì€ Assistantê°€ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” í•˜ë‚˜ ì´ìƒì˜ ë„êµ¬ í˜¸ì¶œ ìš”ì²­ì…ë‹ˆë‹¤.

ì¢…ë¥˜ëŠ” í¬ê²Œ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- function (ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ í˜¸ì¶œ)
- code_interpreter (ì½”ë“œ ì‹¤í–‰ ë„êµ¬)
- file_search (íŒŒì¼ ë‚´ ê²€ìƒ‰ ë„êµ¬, ì—…ë¡œë“œí•œ PDF ë“±)
- ê¸°íƒ€ future tools (ì¶”í›„ í™•ì¥ ê°€ëŠ¥)

### â–¶ function ToolCall ì˜ˆì‹œ

Function íˆ´ì„ ì‚¬ì „ì— ë“±ë¡í–ˆë‹¤ë©´, Assistantê°€ ì‘ë‹µì„ ìƒì„±í•  ë•Œ í•´ë‹¹ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ `get_weather(location: str)`ì„ ë„êµ¬ë¡œ ë“±ë¡í–ˆë‹¤ê³  ê°€ì •í•©ì‹œë‹¤.

Assistant í”„ë¡¬í”„íŠ¸ ì¤‘ì— ë‹¤ìŒê³¼ ê°™ì´ ë°œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```json
{
  "tool_calls": [
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "arguments": "{ \"location\": \"Seoul\" }"
      }
    }
  ]
}
```

ì´ë•Œ OpenAI ì„œë²„ëŠ” ì‹¤ì œ í•¨ìˆ˜ ì‹¤í–‰ì„ ê°œë°œìì—ê²Œ ìœ„ì„í•˜ë©°, ì´ í˜¸ì¶œ ê²°ê³¼ë¥¼ ìˆ˜ì‹ í•˜ë©´ Assistantì˜ ì‘ë‹µì´ ê³„ì† ì´ì–´ì§‘ë‹ˆë‹¤.



## 11.1.6 ToolCall ì²˜ë¦¬ íë¦„

1. Assistantê°€ ë©”ì‹œì§€ë¥¼ ë³´ê³  ë„êµ¬ í˜¸ì¶œì´ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨ â†’ ToolCall í¬í•¨ëœ ì‘ë‹µ ìƒì„±
2. ê°œë°œìê°€ ToolCallì„ ê°ì§€í•˜ê³  ëŒ€ì‘í•˜ì—¬ ì‹¤ì œ í•¨ìˆ˜ë‚˜ ì½”ë“œ ì‹¤í–‰
3. ToolCall ê²°ê³¼ë¥¼ ë‹¤ì‹œ Threadì— Message í˜•íƒœë¡œ ì¶”ê°€
4. ìƒˆë¡œìš´ Run ìˆ˜í–‰ â†’ ìµœì¢… ì‚¬ìš©ì ì „ë‹¬ìš© ì‘ë‹µ ìƒì„±

### ğŸ“Œ ToolCall ì‘ë‹µ ì „ë‹¬

```python
# ToolCall ì‘ë‹µì„ Assistantì— ì „ë‹¬
client.beta.threads.runs.submit_tool_outputs(
    thread_id=thread.id,
    run_id=run.id,
    tool_outputs=[
        {
            "tool_call_id": "call_001",
            "output": "í˜„ì¬ ì„œìš¸ì˜ ë‚ ì”¨ëŠ” ë§‘ê³  25ë„ì…ë‹ˆë‹¤."
        }
    ]
)
```



## 11.1.7 ì „ì²´ íë¦„ ì •ë¦¬

ë‹¤ìŒì€ Assistants APIì˜ ì „ì²´ ì‘ë‹µ íë¦„ì„ ë„ì‹í™”í•œ ê²ƒì…ë‹ˆë‹¤.

```text
ì‚¬ìš©ì ì…ë ¥(Message)
       â†“
Threadì— ë©”ì‹œì§€ ì¶”ê°€
       â†“
Assistant ì‹¤í–‰ ìš”ì²­(Run ìƒì„±)
       â†“
ãƒ»ë‹¨ìˆœ ì‘ë‹µ â†’ ê²°ê³¼ Message ì €ì¥
ãƒ»ë„êµ¬ í•„ìš” â†’ ToolCall ìƒì„±
       â†“
ToolCall ì‹¤í–‰ â†’ ê²°ê³¼ ì „ë‹¬
       â†“
ìµœì¢… Assistant ì‘ë‹µ ìƒì„± â†’ Message ì¶”ê°€
```



## 11.1.8 Message/Run/ToolCall ìƒíƒœ ì¶”ì 

- MessageëŠ” ì‹œê°„ìˆœìœ¼ë¡œ Thread ì•ˆì—ì„œ ê³„ì† ëˆ„ì 
- Runì€ ì‹¤í–‰ ìƒíƒœ (queued, in_progress, completed, requires_action ë“±)ë¡œ êµ¬ë¶„
- ToolCallë„ ê° ë‹¨ê³„ë³„ ìƒíƒœ, ID, ì¸ì ì •ë³´ ë³´ìœ 
- ìƒíƒœ ì¡°íšŒ: `.list()` ë˜ëŠ” `.retrieve()` API ì œê³µ

```python
messages = client.beta.threads.messages.list(thread_id=thread.id)
for m in messages.data:
    print(m.role, m.content)
```



## 11.1.9 í•µì‹¬ ìš”ì•½

| êµ¬ì„± ìš”ì†Œ    | ì„¤ëª… |
|--------------|------|
| Thread       | ì „ì²´ ëŒ€í™” ì„¸ì…˜. ìƒíƒœ ìœ ì§€ |
| Message      | ê°œë³„ ë°œí™”. user / assistant êµ¬ë¶„ |
| Run          | Assistantì˜ ì‹¤í–‰ ë‹¨ìœ„. ë©”ì‹œì§€ â†’ ì‘ë‹µ íë¦„ ì²˜ë¦¬ |
| ToolCall     | ê¸°ëŠ¥ ìˆëŠ” ì‘ë‹µì„ ìœ„í•œ ë„êµ¬ ìš”ì²­. function, code ë“± |



## 11.1.10 ì°¸ê³ : ê¸°ì¡´ Chat Completion APIì™€ì˜ ì°¨ì´ì 

| ê¸°ëŠ¥                      | Chat Completions API | Assistants API |
|---------------------------|----------------------|----------------|
| ëŒ€í™” ìƒíƒœ ì €ì¥            | âŒ ë§¤ë²ˆ ìˆ˜ë™ ì „ë‹¬     | âœ… Thread ë‚´ë¶€ ê´€ë¦¬ |
| Tool Call ì²˜ë¦¬           | âœ… ê°€ëŠ¥ (í•¨ìˆ˜ í˜¸ì¶œ ìœ„ì£¼) | âœ… ë„êµ¬ ì²´ê³„í™”, ì½”ë“œ ì‹¤í–‰ ë“± í¬í•¨ |
| íŒŒì¼ ì—…ë¡œë“œ/ê²€ìƒ‰          | âŒ ë³µì¡                | âœ… ê¸°ë³¸ ì œê³µ ê¸°ëŠ¥ |
| ë‹¤ë‹¨ê³„ ì‘ë‹µ               | âŒ                    | âœ… ToolCall + ì‘ë‹µ íë¦„ |
| ì—ì´ì „íŠ¸ êµ¬ì„±             | âŒ ìì²´ êµ¬í˜„ í•„ìš”       | âœ… Assistantsì— ì„¤ì • |



## ë§ˆë¬´ë¦¬

ì´ ì¥ì—ì„œëŠ” Assistants APIì˜ í•µì‹¬ êµ¬ì¡°ì¸ Thread, Message, ToolCallì˜ ê°œë…ê³¼ ì§ê´€ì ì¸ ì‚¬ìš© íë¦„ì„ ìƒì„¸íˆ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì¥ì—ì„œëŠ” ì´ëŸ¬í•œ ê¸°ì´ˆ ì§€ì‹ì„ ë°”íƒ•ìœ¼ë¡œ, Functions, File Search, Code Interpreter ë“± ì‹¤ì œ ê¸°ëŠ¥ì„ Assistants ì•ˆì—ì„œ í†µí•©ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ì˜ˆì œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.

ğŸ”œ ê³„ì†í•´ì„œ 11.2ì¥ ã€Œì½”ë“œ ì‹¤í–‰(Code Interpreter) ì—°ë™ã€ìœ¼ë¡œ ì´ë™í•˜ì—¬, ToolCall ì¤‘ 'code_interpreter' ë„êµ¬ í™œìš©ë²•ì„ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.