Chapter 11.2 ì½”ë“œ ì‹¤í–‰(Code Interpreter) ì—°ë™

OpenAI Assistants APIì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ëŠ” ë°”ë¡œ Tool ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì´ ì¤‘ Code InterpreterëŠ” ë§ì€ ì‚¬ìš©ìì—ê²Œ ì˜ ì•Œë ¤ì§„ ChatGPTì˜ â€œAdvanced Data Analysis(êµ¬ Advanced Code Interpreter)â€ ê¸°ëŠ¥ê³¼ ê°™ì€ ê²ƒìœ¼ë¡œ, ìì—°ì–´ ëª…ë ¹ì„ í•´ì„í•˜ì—¬ Python ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ ë‹¤ì‹œ ëŒ€í™”ë¡œ ì´ì–´ê°€ëŠ” í˜•ì‹ì˜ ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤. ì´ ì ˆì—ì„œëŠ” Assistants APIì—ì„œ Code Interpreterë¥¼ ì—°ë™í•˜ê³  í™œìš©í•˜ëŠ” ë°©ë²•ì„ ì‹¤ìŠµê³¼ í•¨ê»˜ ì•Œì•„ë´…ë‹ˆë‹¤.

11.2.1 Code Interpreterë€?

Code InterpreterëŠ” ì•ˆì „í•œ ìƒŒë“œë°•ìŠ¤ í™˜ê²½ì—ì„œ ì‚¬ìš©ì ëª…ë ¹ì— ë”°ë¼ Python ì½”ë“œë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ë©° ê²°ê³¼ë¥¼ Markdown ë˜ëŠ” ìì—°ì–´ë¡œ ìš”ì•½í•´ ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì£¼ìš” íŠ¹ì§•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- Python ì–¸ì–´ ì§€ì›
- Numpy, Pandas, Matplotlib ë“± ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚´ì¥
- CSV, JSON, ì´ë¯¸ì§€ ë“± ë‹¤ì–‘í•œ íŒŒì¼ í˜•ì‹ ë¶„ì„ ê°€ëŠ¥
- ê·¸ë˜í”„ ì‹œê°í™” ìë™ ì²˜ë¦¬
- ìì—°ì–´ë¡œ ë°ì´í„° ì´í•´ ë° í”¼ë´‡íŒ… ê°€ëŠ¥

OpenAI Assistant APIì—ì„œëŠ” í•´ë‹¹ ê¸°ëŠ¥ì„ toolë¡œ í™œì„±í™”ì‹œì¼œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, íŒŒì¼ ì—…ë¡œë“œì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ë”ìš± ê°•ë ¥í•œ ë°ì´í„° ë¶„ì„ ê¸°ëŠ¥ì„ ë°œíœ˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

11.2.2 Code Interpreter í™œì„±í™”í•˜ê¸°

Code InterpreterëŠ” Assistants APIì—ì„œ tools ë§¤ê°œë³€ìˆ˜ì— "code_interpreter"ë¥¼ í¬í•¨í•˜ì—¬ í™œì„±í™”í•©ë‹ˆë‹¤. ë¨¼ì € Assistantë¥¼ ìƒì„±í•  ë•Œ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.

ğŸ“Œ Python ì˜ˆì‹œ:

```python
from openai import OpenAI

client = OpenAI()

assistant = client.beta.assistants.create(
    name="Data Analyst",
    instructions="ì—…ë¡œë“œëœ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìš”ì•½í•´ ì£¼ì„¸ìš”.",
    model="gpt-4-1106-preview",
    tools=[{"type": "code_interpreter"}]
)
```

ì—¬ê¸°ì„œ tools í•„ë“œì— {"type": "code_interpreter"} í•­ëª©ì„ ì¶”ê°€í•¨ìœ¼ë¡œì¨ í•´ë‹¹ AssistantëŠ” ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ í™˜ê²½ì„ ê°€ì§‘ë‹ˆë‹¤.

11.2.3 Code Interpreter ì‚¬ìš© íë¦„

Code Interpreterì˜ ì‚¬ìš© íë¦„ì€ ì¼ë°˜ì ì¸ Assistants API í˜¸ì¶œ íë¦„ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, íŒŒì¼ ì—°ë™ê³¼ ì½”ë“œ ì‹¤í–‰ ê²°ê³¼ ë°˜í™˜ì´ ì¤‘ìš”í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤. ê¸°ë³¸ íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. Assistant ìƒì„± (toolsì— code_interpreter í¬í•¨)
2. Thread ìƒì„±
3. íŒŒì¼ ì—…ë¡œë“œ (ì„ íƒ ì‚¬í•­)
4. ë©”ì‹œì§€ ì¶”ê°€ (ë¬¸ìì—´ë¡œ ì§ˆë¬¸)
5. Run ì‹¤í–‰
6. Run ìƒíƒœ(pending, in_progress, completed) ëª¨ë‹ˆí„°ë§
7. ê²°ê³¼ ë©”ì‹œì§€ í™•ì¸ (ì½”ë“œ ì‹¤í–‰ ê²°ê³¼ í¬í•¨)

ì•„ë˜ ì˜ˆì‹œëŠ” CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³ , íŠ¹ì • ì§ˆë¬¸ì„ ë˜ì§€ë©° Assistantê°€ ì´ë¥¼ ì½”ë“œë¡œ í•´ì„í•´ ë¶„ì„ ì‘ë‹µì„ í•˜ëŠ” ì „í˜•ì ì¸ ì›Œí¬í”Œë¡œì…ë‹ˆë‹¤.

11.2.4 íŒŒì¼ ì—…ë¡œë“œ ë° ì—°ê²°

Code Interpreterì™€ í•¨ê»˜ ê°€ì¥ ìì£¼ ì‚¬ìš©ë˜ëŠ” ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ëŠ” íŒŒì¼ ì—…ë¡œë“œì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë°ì´í„°ë¥¼ ë‹´ì€ CSV íŒŒì¼ì„ ë¶„ì„ ëŒ€ìƒìœ¼ë¡œ ì²¨ë¶€í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ë©”ì‹œì§€ì— ì—°ê²°í•©ë‹ˆë‹¤.

ğŸ“Œ íŒŒì¼ ì—…ë¡œë“œ ì˜ˆì‹œ:

```python
# CSV íŒŒì¼ ì—…ë¡œë“œ
file = client.files.create(
    file=open("sales_data.csv", "rb"),
    purpose="assistants"
)
```

íŒŒì¼ ì—…ë¡œë“œ ì´í›„, ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œ file_idë¥¼ í•¨ê»˜ ì „ë‹¬í•˜ì—¬ Assistantê°€ í•´ë‹¹ ë°ì´í„°ë¥¼ ì½”ë“œ í•´ì„ì— ì°¸ì¡°í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“Œ ë©”ì‹œì§€ ì¶”ê°€ ì˜ˆì‹œ (íŒŒì¼ ì—°ê²° í¬í•¨):

```python
thread = client.beta.threads.create()

message = client.beta.threads.messages.create(
    thread_id=thread.id,
    role="user",
    content="ì´ ë°ì´í„°ì—ì„œ ì›”ë³„ í‰ê·  íŒë§¤ëŸ‰ì„ ê³„ì‚°í•´ì¤˜.",
    file_ids=[file.id]
)
```

ì´í›„ runì„ ì‹¤í–‰í•˜ë©´ì„œ ì‹¤ì œ ì½”ë“œ ì‹¤í–‰ì´ ì‹œì‘ë©ë‹ˆë‹¤.

ğŸ“Œ Run ìƒì„±:

```python
run = client.beta.threads.runs.create(
    thread_id=thread.id,
    assistant_id=assistant.id
)
```

11.2.5 ì½”ë“œ ì‹¤í–‰ ë° ê²°ê³¼ í™•ì¸

ì‹¤í–‰ ì´í›„ run ìƒíƒœë¥¼ ì²´í¬í•˜ë©° ìµœì¢… ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°í•´ì•¼ í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒì²˜ëŸ¼ polling ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.

ğŸ“Œ Run ìƒíƒœ í™•ì¸:

```python
import time

while True:
    run_status = client.beta.threads.runs.retrieve(
        thread_id=thread.id,
        run_id=run.id
    )
    if run_status.status in ["completed", "failed"]:
        break
    time.sleep(1)
```

ğŸ“Œ ì‹¤í–‰ ê²°ê³¼ í™•ì¸:

```python
messages = client.beta.threads.messages.list(thread_id=thread.id)

for msg in messages.data:
    print(msg.role + ":", msg.content[0].text.value)
```

ì—¬ê¸°ì„œ ì¶œë ¥ë˜ëŠ” assistantì˜ ì‘ë‹µì—ëŠ” ë¶„ì„ ê²°ê³¼ ë˜ëŠ” ì‹œê°í™” ë‚´ìš©ì´ Markdown í˜•íƒœë¡œ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë©°, ì´ë¯¸ì§€ ì¶œë ¥ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ matplotlibë¥¼ í†µí•´ ìƒì„±ëœ ê·¸ë˜í”„ê°€ ì´ë¯¸ì§€ base64 í˜•íƒœë¡œ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

11.2.6 ë³µìˆ˜ íŒŒì¼ ì²˜ë¦¬ ë° ê³ ê¸‰ ì§ˆë¬¸ ì˜ˆì‹œ

â– ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì¢…í•© ë¶„ì„ ìš”ì²­í•˜ê¸°:

```python
file1 = client.files.create(file=open("2022_sales.csv", "rb"), purpose="assistants")
file2 = client.files.create(file=open("2023_sales.csv", "rb"), purpose="assistants")

msg = client.beta.threads.messages.create(
    thread_id=thread.id,
    role="user",
    content="ë‘ íŒŒì¼ì˜ ì›”ë³„ í‰ê·  ë§¤ì¶œì„ ë¹„êµí•´ ì°¨íŠ¸ë¥¼ ë³´ì—¬ì¤˜.",
    file_ids=[file1.id, file2.id]
)
```

â– ë³µì¡í•œ ë°ì´í„° ë³€í™˜ ìš”êµ¬:

" ê³ ê°ë³„ ì´ êµ¬ë§¤ê¸ˆì•¡ì„ ì§‘ê³„í•´ 1ìœ„ë¥¼ ì•Œë ¤ì£¼ê³ , êµ¬ë§¤ ì¶”ì´ë„ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì¤˜."

ì´ ê²½ìš° AssistantëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤:

- Pandasë¡œ ì½ê¸° â†’ ê·¸ë£¹í™”(groupby) â†’ í•©ê³„ ê³„ì‚°
- ìµœëŒ€ê°’ ì¶”ì¶œ â†’ ì‹œê°í™” (Matplotlib)
- Markdown ì‘ë‹µìœ¼ë¡œ ìš”ì•½ + ê·¸ë˜í”„ ì´ë¯¸ì§€ í¬í•¨

11.2.7 ì˜¤ë¥˜ ì²˜ë¦¬ ë° ë””ë²„ê¹… íŒ

- íŒŒì¼ í¬ê¸° ì œí•œì€ í˜„ì¬ ì•½ 500MB, ë„ˆë¬´ í¬ë©´ ì˜¤ë¥˜ ë°œìƒ
- ì—…ë¡œë“œí•œ íŒŒì¼ì€ ë©”ì‹œì§€ì— ëª…í™•íˆ file_idsë¡œ ì—°ê²°í•´ì•¼ í•¨
- Assistant instructionsì— ë°ì´í„° í˜•ì‹, ì–¸ì–´, ë¶„ì„ ëª©ì  ë“±ì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ì¬í•˜ë©´ ë¶„ì„ ì •ë°€ë„ í–¥ìƒ
- run ì‹¤íŒ¨ ì‹œ run.statusë¥¼ í™•ì¸í•˜ë©´ ì˜¤ë¥˜ ìœ í˜•ì„ ë¶„ì„ ê°€ëŠ¥ ("failed" ìƒíƒœì—ì„œ error.message í™•ì¸)

11.2.8 Code Interpreter ê¸°ëŠ¥ ì œì•½ ë° ì£¼ì˜ì‚¬í•­

| í•­ëª© | ì œí•œ/ì£¼ì˜ ê°ˆì  |
|------|----------------|
| ì™¸ë¶€ API í˜¸ì¶œ | ë¶ˆê°€ëŠ¥ (HTTP ìš”ì²­ ì œí•œë¨) |
| íŒŒì¼ ì €ì¥ | ê°€ëŠ¥í•˜ë‚˜ ìœ ì € ì ‘ê·¼ì€ ì œí•œì  |
| ì‹¤í–‰ ì‹œê°„ | ë³µì¡í•œ ë¶„ì„ì€ íƒ€ì„ì•„ì›ƒ ë°œìƒ ê°€ëŠ¥ì„± |
| ë³´ì•ˆ | ì—…ë¡œë“œëœ íŒŒì¼ì€ OpenAI ì„œë²„ ë‚´ ì„ì‹œ ì €ì¥ë¨ |

ë˜í•œ, Assistant ì„¸ì…˜ë³„ë¡œ ìƒíƒœë¥¼ ìœ ì§€í•˜ë¯€ë¡œ ì—°ì†ì ì¸ ë¶„ì„ íë¦„ì„ ì„¤ê³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¨, ê° ë¶„ì„ë‹¨ê³„ê°€ ë…ì…ì ìœ¼ë¡œ ìˆ˜í–‰ë˜ë¯€ë¡œ ëª…í™•í•œ ì—°ê²° ì§€ì‹œê°€ í•„ìš”í•©ë‹ˆë‹¤.

11.2.9 ì‹¤ì „ ì˜ˆì œ: ì‹œê°í™” í¬í•¨ ë°ì´í„° ë¶„ì„ ì±—ë´‡

- ì „ì²˜ë¦¬ & ì‹œê°í™”ë¥¼ í¬í•¨í•œ ì¸ì‚¬ì´íŠ¸ ì±—ë´‡ êµ¬ì„±
- ë¶„ì„ ìœ í˜•: ë¶„í¬ ë¶„ì„, ì´ìƒì¹˜ íƒì§€, ì¶”ì„¸ ì¶”ì •, ìƒê´€ê³„ìˆ˜ ê³„ì‚° ë“±
- ì‚¬ìš© ê¸°ìˆ : Assistant API + Code Interpreter + file_ids ë¦¬í”Œë ˆì´ìŠ¤

ğŸ“Œ ì „ì²´ ì›Œí¬í”Œë¡œ ì˜ˆì‹œ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

```python
# ì–´ì‹œìŠ¤í„´íŠ¸ ìƒì„±
assistant = client.beta.assistants.create(
    name="CSV Insight Bot",
    instructions="CSV ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ì‹œê°í™”ëœ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
    model="gpt-4-1106-preview",
    tools=[{"type": "code_interpreter"}]
)

# Thread ìƒì„±
thread = client.beta.threads.create()

# ë°ì´í„° íŒŒì¼ ì—…ë¡œë“œ
file = client.files.create(
    file=open("dataset.csv", "rb"),
    purpose="assistants"
)

# ì§ˆë¬¸ ë©”ì‹œì§€ ì¶”ê°€
message = client.beta.threads.messages.create(
    thread_id=thread.id,
    role="user",
    content="ì´ ë°ì´í„°ì—ì„œ ìƒê´€ê´€ê³„ë¥¼ ë¶„ì„í•˜ê³  scatter plotìœ¼ë¡œ ë³´ì—¬ì¤˜.",
    file_ids=[file.id]
)

# ì‹¤í–‰
run = client.beta.threads.runs.create(
    thread_id=thread.id,
    assistant_id=assistant.id
)

# Run ìƒíƒœ í™•ì¸ ë° ê²°ê³¼ ì¶œë ¥
while True:
    run_status = client.beta.threads.runs.retrieve(
        thread_id=thread.id,
        run_id=run.id
    )
    if run_status.status == "completed":
        break
    elif run_status.status == "failed":
        print("ì˜¤ë¥˜ ë°œìƒ:", run_status.last_error)
        break
    time.sleep(1)

messages = client.beta.threads.messages.list(thread_id=thread.id)
for msg in messages.data:
    print(msg.role + ":", msg.content[0].text.value)
```

11.2.10 ì •ë¦¬ ë° ë‹¤ìŒ ìŠ¤í…

Code Interpreter ë„êµ¬ëŠ” OpenAI Assistants APIì˜ ì£¼ìš” íŒŒì›Œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë‹¨ìˆœ ëŒ€í™”í˜• Agentë¥¼ ë„˜ì–´ì„œ ì‹¤ì§ˆì ì¸ ë°ì´í„° ë¶„ì„ ì—…ë¬´ë¥¼ ìë™í™”í•˜ê±°ë‚˜ CSV ê¸°ë°˜ ë ˆí¬íŠ¸ ìƒì„±ê¸°ë¥¼ êµ¬í˜„í•˜ëŠ” ë° ë§¤ìš° ì í•©í•©ë‹ˆë‹¤. í–¥í›„ Chaptersì—ì„œëŠ” Code Interpreterë¿ ì•„ë‹ˆë¼ Search, Function Callê³¼ ì¡°í•©ëœ ë©€í‹° íˆ´ ê¸°ë°˜ì˜ ê³ ë„í™”ëœ ì—ì´ì „íŠ¸ ì„¤ê³„ë¡œ í™•ì¥í•˜ê²Œ ë©ë‹ˆë‹¤.

â¡ï¸ ë‹¤ìŒ ì ˆì—ì„œëŠ” íŒŒì¼ ì—…ë¡œë“œ + ê²€ìƒ‰ + ì½”ë“œ ì‹¤í–‰ì„ í•¨ê»˜ í™œìš©í•˜ëŠ” ë³µí•© Tool ì¡°í•© ì˜ˆì œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.